{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Github\\\\Diplomarbeit\\\\errorkb-frontend\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"D:\\\\Github\\\\Diplomarbeit\\\\errorkb-frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"D:\\\\Github\\\\Diplomarbeit\\\\errorkb-frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:\\\\Github\\\\Diplomarbeit\\\\errorkb-frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{Component,useEffect}from'react';import'../App.css';import{useCookies}from\"react-cookie\";import{forwardRef}from'react';import MaterialTable from'material-table';import AddBox from'@material-ui/icons/AddBox';import ArrowDownward from'@material-ui/icons/ArrowDownward';import Check from'@material-ui/icons/Check';import ChevronLeft from'@material-ui/icons/ChevronLeft';import ChevronRight from'@material-ui/icons/ChevronRight';import Clear from'@material-ui/icons/Clear';import DeleteOutline from'@material-ui/icons/DeleteOutline';import Edit from'@material-ui/icons/Edit';import FilterList from'@material-ui/icons/FilterList';import FirstPage from'@material-ui/icons/FirstPage';import LastPage from'@material-ui/icons/LastPage';import Remove from'@material-ui/icons/Remove';import SaveAlt from'@material-ui/icons/SaveAlt';import Search from'@material-ui/icons/Search';import ViewColumn from'@material-ui/icons/ViewColumn';var tableIcons={Add:forwardRef(function(props,ref){return React.createElement(AddBox,Object.assign({},props,{ref:ref}));}),Check:forwardRef(function(props,ref){return React.createElement(Check,Object.assign({},props,{ref:ref}));}),Clear:forwardRef(function(props,ref){return React.createElement(Clear,Object.assign({},props,{ref:ref}));}),Delete:forwardRef(function(props,ref){return React.createElement(DeleteOutline,Object.assign({},props,{ref:ref}));}),DetailPanel:forwardRef(function(props,ref){return React.createElement(ChevronRight,Object.assign({},props,{ref:ref}));}),Edit:forwardRef(function(props,ref){return React.createElement(Edit,Object.assign({},props,{ref:ref}));}),Export:forwardRef(function(props,ref){return React.createElement(SaveAlt,Object.assign({},props,{ref:ref}));}),Filter:forwardRef(function(props,ref){return React.createElement(FilterList,Object.assign({},props,{ref:ref}));}),FirstPage:forwardRef(function(props,ref){return React.createElement(FirstPage,Object.assign({},props,{ref:ref}));}),LastPage:forwardRef(function(props,ref){return React.createElement(LastPage,Object.assign({},props,{ref:ref}));}),NextPage:forwardRef(function(props,ref){return React.createElement(ChevronRight,Object.assign({},props,{ref:ref}));}),PreviousPage:forwardRef(function(props,ref){return React.createElement(ChevronLeft,Object.assign({},props,{ref:ref}));}),ResetSearch:forwardRef(function(props,ref){return React.createElement(Clear,Object.assign({},props,{ref:ref}));}),Search:forwardRef(function(props,ref){return React.createElement(Search,Object.assign({},props,{ref:ref}));}),SortArrow:forwardRef(function(props,ref){return React.createElement(ArrowDownward,Object.assign({},props,{ref:ref}));}),ThirdStateCheck:forwardRef(function(props,ref){return React.createElement(Remove,Object.assign({},props,{ref:ref}));}),ViewColumn:forwardRef(function(props,ref){return React.createElement(ViewColumn,Object.assign({},props,{ref:ref}));})};export default function UserMgmt(){var request=require('superagent');var _useCookies=useCookies(['user']),_useCookies2=_slicedToArray(_useCookies,3),cookies=_useCookies2[0],setCookie=_useCookies2[1],removeCookie=_useCookies2[2];var pathStart=window.location.protocol+\"//\"+window.location.host;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isAdm=_React$useState2[0],setAdm=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isLoggedIn=_React$useState4[0],setLoggedIn=_React$useState4[1];var _React$useState5=React.useState({columns:[{title:'Username',field:'username'},{title:'Password',field:'password'},{title:'Privileges',field:'priv',lookup:{admin:'admin',user:'user'}}],data:[]}),_React$useState6=_slicedToArray(_React$useState5,2),state=_React$useState6[0],setState=_React$useState6[1];var getUsers=function getUsers(){var url,response,userdata,_loop,i;return _regeneratorRuntime.async(function getUsers$(_context){while(1){switch(_context.prev=_context.next){case 0:url=pathStart+\":8080/errorkb/api/GetAllUsers\";_context.next=3;return _regeneratorRuntime.awrap(fetch(url));case 3:response=_context.sent;_context.next=6;return _regeneratorRuntime.awrap(response.json());case 6:userdata=_context.sent;_loop=function _loop(i){new Promise(function(resolve){{resolve();setState(function(prevState){var data=_toConsumableArray(prevState.data);data.push({username:userdata[i].username,password:\"********\",priv:userdata[i].privileges});return _objectSpread({},prevState,{data:data});});}});};for(i=0;i<userdata.length;i++){_loop(i);}case 9:case\"end\":return _context.stop();}}});};var readCookieUser=function readCookieUser(){var user=cookies.user;if(user!=null){setLoggedIn(true);}else{setLoggedIn(false);window.location=\"/\";}};var readCookieRights=function readCookieRights(){var rights=cookies.rights;if(rights=='admin'){}else{window.location=\"/\";}};useEffect(function(){getUsers();readCookieUser();readCookieRights();},[]);return React.createElement(MaterialTable,{title:\"User Management\",columns:state.columns,data:state.data,icons:tableIcons,editable:{onRowAdd:function onRowAdd(newData){return new Promise(function(resolve){setTimeout(function(){resolve();setState(function _callee(prevState){var data,url,response;return _regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=_toConsumableArray(prevState.data);_context2.prev=1;if(!(newData.password==null)){_context2.next=5;break;}alert(\"Please assign a password\");return _context2.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 5:if(!(newData.username==null)){_context2.next=8;break;}alert(\"Please assign a username\");return _context2.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 8:url=pathStart+\":8080/errorkb/api/PostNewUser/?username=\"+newData.username+\"&password=\"+newData.password+\"&priv=\"+newData.priv;_context2.next=11;return _regeneratorRuntime.awrap(request('POST',url));case 11:response=_context2.sent;if(!(response.statusCode==200)){_context2.next=15;break;}data.push(newData);return _context2.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 15:_context2.next=21;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](1);alert(_context2.t0.message);return _context2.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 21:_context2.prev=21;window.location.reload();return _context2.finish(21);case 24:case\"end\":return _context2.stop();}}},null,null,[[1,17,21,24]]);});},600);});},onRowUpdate:function onRowUpdate(newData,oldData){return new Promise(function(resolve){setTimeout(function(){resolve();if(oldData){console.log(oldData.username);console.log(newData);setState(function _callee2(prevState){var data,url,response,_url,_response;return _regeneratorRuntime.async(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:data=_toConsumableArray(prevState.data);_context3.prev=1;if(!(newData.password==null)){_context3.next=5;break;}alert(\"Please assign a password\");return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 5:if(!(newData.username==null)){_context3.next=8;break;}alert(\"Please assign a username\");return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 8:if(!(newData.priv!=\"admin\"&&newData.priv!=\"user\")){_context3.next=11;break;}alert(\"Please assign valid privileges\");return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 11:if(!(newData.password==oldData.password)){_context3.next=19;break;}url=pathStart+\":8080/errorkb/api/PutNewUser/?oldUsername=\"+oldData.username+\"&newUsername=\"+newData.username+\"&newPriv=\"+newData.priv;_context3.next=15;return _regeneratorRuntime.awrap(request('PUT',url));case 15:response=_context3.sent;if(!(response.statusCode==200)){_context3.next=19;break;}data[data.indexOf(oldData)]=newData;return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 19:if(!(newData.password!=oldData.password)){_context3.next=27;break;}_url=pathStart+\":8080/errorkb/api/PutNewUser/?oldUsername=\"+oldData.username+\"&newUsername=\"+newData.username+\"&newPassword=\"+newData.password+\"&newPriv=\"+newData.priv;_context3.next=23;return _regeneratorRuntime.awrap(request('PUT',_url));case 23:_response=_context3.sent;if(!(_response.statusCode==200)){_context3.next=27;break;}data[data.indexOf(oldData)]=newData;return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 27:_context3.next=33;break;case 29:_context3.prev=29;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.message);return _context3.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 33:_context3.prev=33;window.location.reload();return _context3.finish(33);case 36:case\"end\":return _context3.stop();}}},null,null,[[1,29,33,36]]);});}},600);});},onRowDelete:function onRowDelete(oldData){return new Promise(function(resolve){setTimeout(function(){resolve();setState(function _callee3(prevState){var data,url,response;return _regeneratorRuntime.async(function _callee3$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:data=_toConsumableArray(prevState.data);url=pathStart+\":8080/errorkb/Api/DeleteUser?username=\"+oldData.username;_context4.prev=2;_context4.next=5;return _regeneratorRuntime.awrap(request('DELETE',url));case 5:response=_context4.sent;if(!(response.statusCode==200)){_context4.next=9;break;}data.splice(data.indexOf(oldData),1);return _context4.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 9:_context4.next=15;break;case 11:_context4.prev=11;_context4.t0=_context4[\"catch\"](2);alert(_context4.t0.message);return _context4.abrupt(\"return\",_objectSpread({},prevState,{data:data}));case 15:_context4.prev=15;window.location.reload();return _context4.finish(15);case 18:case\"end\":return _context4.stop();}}},null,null,[[2,11,15,18]]);});},600);});}}});}","map":{"version":3,"sources":["D:/Github/Diplomarbeit/errorkb-frontend/src/components/UserMgmt.jsx"],"names":["React","Component","useEffect","useCookies","forwardRef","MaterialTable","AddBox","ArrowDownward","Check","ChevronLeft","ChevronRight","Clear","DeleteOutline","Edit","FilterList","FirstPage","LastPage","Remove","SaveAlt","Search","ViewColumn","tableIcons","Add","props","ref","Delete","DetailPanel","Export","Filter","NextPage","PreviousPage","ResetSearch","SortArrow","ThirdStateCheck","UserMgmt","request","require","cookies","setCookie","removeCookie","pathStart","window","location","protocol","host","useState","isAdm","setAdm","isLoggedIn","setLoggedIn","columns","title","field","lookup","admin","user","data","state","setState","getUsers","url","fetch","response","json","userdata","i","Promise","resolve","prevState","push","username","password","priv","privileges","length","readCookieUser","readCookieRights","rights","onRowAdd","newData","setTimeout","alert","statusCode","message","reload","onRowUpdate","oldData","console","log","indexOf","onRowDelete","splice"],"mappings":"8fAAA,MAAOA,CAAAA,KAAP,EAAeC,SAAf,CAA0BC,SAA1B,KAA0C,OAA1C,CACA,MAAO,YAAP,CACA,OAAQC,UAAR,KAAyB,cAAzB,CACA,OAASC,UAAT,KAA2B,OAA3B,CACA,MAAOC,CAAAA,aAAP,KAA0B,gBAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,2BAAnB,CACA,MAAOC,CAAAA,aAAP,KAA0B,kCAA1B,CACA,MAAOC,CAAAA,KAAP,KAAkB,0BAAlB,CACA,MAAOC,CAAAA,WAAP,KAAwB,gCAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,iCAAzB,CACA,MAAOC,CAAAA,KAAP,KAAkB,0BAAlB,CACA,MAAOC,CAAAA,aAAP,KAA0B,kCAA1B,CACA,MAAOC,CAAAA,IAAP,KAAiB,yBAAjB,CACA,MAAOC,CAAAA,UAAP,KAAuB,+BAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,8BAAtB,CACA,MAAOC,CAAAA,QAAP,KAAqB,6BAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,2BAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,4BAApB,CACA,MAAOC,CAAAA,MAAP,KAAmB,2BAAnB,CACA,MAAOC,CAAAA,UAAP,KAAuB,+BAAvB,CAGA,GAAMC,CAAAA,UAAU,CAAG,CACfC,GAAG,CAAElB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,MAAD,kBAAYD,KAAZ,EAAmB,GAAG,CAAEC,GAAxB,GAAhB,EAAD,CADA,CAEfhB,KAAK,CAAEJ,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,KAAD,kBAAWD,KAAX,EAAkB,GAAG,CAAEC,GAAvB,GAAhB,EAAD,CAFF,CAGfb,KAAK,CAAEP,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,KAAD,kBAAWD,KAAX,EAAkB,GAAG,CAAEC,GAAvB,GAAhB,EAAD,CAHF,CAIfC,MAAM,CAAErB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,aAAD,kBAAmBD,KAAnB,EAA0B,GAAG,CAAEC,GAA/B,GAAhB,EAAD,CAJH,CAKfE,WAAW,CAAEtB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,YAAD,kBAAkBD,KAAlB,EAAyB,GAAG,CAAEC,GAA9B,GAAhB,EAAD,CALR,CAMfX,IAAI,CAAET,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,IAAD,kBAAUD,KAAV,EAAiB,GAAG,CAAEC,GAAtB,GAAhB,EAAD,CAND,CAOfG,MAAM,CAAEvB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,OAAD,kBAAaD,KAAb,EAAoB,GAAG,CAAEC,GAAzB,GAAhB,EAAD,CAPH,CAQfI,MAAM,CAAExB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,UAAD,kBAAgBD,KAAhB,EAAuB,GAAG,CAAEC,GAA5B,GAAhB,EAAD,CARH,CASfT,SAAS,CAAEX,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,SAAD,kBAAeD,KAAf,EAAsB,GAAG,CAAEC,GAA3B,GAAhB,EAAD,CATN,CAUfR,QAAQ,CAAEZ,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,QAAD,kBAAcD,KAAd,EAAqB,GAAG,CAAEC,GAA1B,GAAhB,EAAD,CAVL,CAWfK,QAAQ,CAAEzB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,YAAD,kBAAkBD,KAAlB,EAAyB,GAAG,CAAEC,GAA9B,GAAhB,EAAD,CAXL,CAYfM,YAAY,CAAE1B,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,WAAD,kBAAiBD,KAAjB,EAAwB,GAAG,CAAEC,GAA7B,GAAhB,EAAD,CAZT,CAafO,WAAW,CAAE3B,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,KAAD,kBAAWD,KAAX,EAAkB,GAAG,CAAEC,GAAvB,GAAhB,EAAD,CAbR,CAcfL,MAAM,CAAEf,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,MAAD,kBAAYD,KAAZ,EAAmB,GAAG,CAAEC,GAAxB,GAAhB,EAAD,CAdH,CAefQ,SAAS,CAAE5B,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,aAAD,kBAAmBD,KAAnB,EAA0B,GAAG,CAAEC,GAA/B,GAAhB,EAAD,CAfN,CAgBfS,eAAe,CAAE7B,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,MAAD,kBAAYD,KAAZ,EAAmB,GAAG,CAAEC,GAAxB,GAAhB,EAAD,CAhBZ,CAiBfJ,UAAU,CAAEhB,UAAU,CAAC,SAACmB,KAAD,CAAQC,GAAR,QAAgB,qBAAC,UAAD,kBAAgBD,KAAhB,EAAuB,GAAG,CAAEC,GAA5B,GAAhB,EAAD,CAjBP,CAAnB,CAqBA,cAAe,SAASU,CAAAA,QAAT,EAAoB,CAC/B,GAAIC,CAAAA,OAAO,CAAGC,OAAO,CAAC,YAAD,CAArB,CAD+B,gBAEYjC,UAAU,CAAC,CAAC,MAAD,CAAD,CAFtB,4CAExBkC,OAFwB,iBAEfC,SAFe,iBAEJC,YAFI,iBAG/B,GAAMC,CAAAA,SAAS,CAAGC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAA2B,IAA3B,CAAkCF,MAAM,CAACC,QAAP,CAAgBE,IAApE,CAH+B,oBAIR5C,KAAK,CAAC6C,QAAN,CAAe,KAAf,CAJQ,oDAIxBC,KAJwB,qBAIlBC,MAJkB,0CAKE/C,KAAK,CAAC6C,QAAN,CAAe,KAAf,CALF,qDAKxBG,UALwB,qBAKbC,WALa,0CAOLjD,KAAK,CAAC6C,QAAN,CAAe,CACrCK,OAAO,CAAE,CACL,CAAEC,KAAK,CAAE,UAAT,CAAqBC,KAAK,CAAE,UAA5B,CADK,CAEL,CAAED,KAAK,CAAE,UAAT,CAAqBC,KAAK,CAAE,UAA5B,CAFK,CAGL,CAAED,KAAK,CAAE,YAAT,CAAuBC,KAAK,CAAE,MAA9B,CAAsCC,MAAM,CAAC,CAACC,KAAK,CAAC,OAAP,CAAeC,IAAI,CAAC,MAApB,CAA7C,CAHK,CAD4B,CAMrCC,IAAI,CAAE,EAN+B,CAAf,CAPK,qDAOxBC,KAPwB,qBAOjBC,QAPiB,qBAkB/B,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,uJAEPC,GAFO,CAEDpB,SAAS,CAAG,+BAFX,kDAGUqB,KAAK,CAACD,GAAD,CAHf,SAGPE,QAHO,gEAIUA,QAAQ,CAACC,IAAT,EAJV,SAIPC,QAJO,oCAKLC,CALK,EAMT,GAAIC,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CACnB,CAACA,OAAO,GACJT,QAAQ,CAAC,SAAAU,SAAS,CAAI,CAClB,GAAMZ,CAAAA,IAAI,oBAAOY,SAAS,CAACZ,IAAjB,CAAV,CACAA,IAAI,CAACa,IAAL,CAAU,CAACC,QAAQ,CAACN,QAAQ,CAACC,CAAD,CAAR,CAAYK,QAAtB,CAA+BC,QAAQ,CAAC,UAAxC,CAAmDC,IAAI,CAACR,QAAQ,CAACC,CAAD,CAAR,CAAYQ,UAApE,CAAV,EACA,wBAAYL,SAAZ,EAAuBZ,IAAI,CAAJA,IAAvB,GACH,CAJO,CAAR,CAKH,CACJ,CARD,EANS,EAKb,IAAQS,CAAR,CAAY,CAAZ,CAAgBA,CAAC,CAAGD,QAAQ,CAACU,MAA7B,CAAqCT,CAAC,EAAtC,CAAyC,OAAjCA,CAAiC,EAUxC,CAfY,8CAAjB,CAmBA,GAAMU,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CACzB,GAAMpB,CAAAA,IAAI,CAAGlB,OAAO,CAACkB,IAArB,CACA,GAAIA,IAAI,EAAI,IAAZ,CAAkB,CACdN,WAAW,CAAC,IAAD,CAAX,CACH,CAFD,IAGI,CACAA,WAAW,CAAC,KAAD,CAAX,CACAR,MAAM,CAACC,QAAP,CAAgB,GAAhB,CACH,CACJ,CATD,CAUA,GAAMkC,CAAAA,gBAAgB,CAAC,QAAjBA,CAAAA,gBAAiB,EAAI,CACvB,GAAMC,CAAAA,MAAM,CAAGxC,OAAO,CAACwC,MAAvB,CACA,GAAIA,MAAM,EAAI,OAAd,CAAuB,CACtB,CADD,IAEI,CACApC,MAAM,CAACC,QAAP,CAAgB,GAAhB,CACH,CACJ,CAPD,CAQAxC,SAAS,CAAC,UAAI,CACVyD,QAAQ,GACRgB,cAAc,GACdC,gBAAgB,GACnB,CAJQ,CAIP,EAJO,CAAT,CAKA,MAEI,qBAAC,aAAD,EACI,KAAK,CAAC,iBADV,CAEI,OAAO,CAAEnB,KAAK,CAACP,OAFnB,CAGI,IAAI,CAAEO,KAAK,CAACD,IAHhB,CAII,KAAK,CAAEnC,UAJX,CAKI,QAAQ,CAAE,CACNyD,QAAQ,CAAE,kBAAAC,OAAO,QACb,IAAIb,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CACnBa,UAAU,CAAC,UAAM,CACbb,OAAO,GACPT,QAAQ,CAAC,iBAAMU,SAAN,4IACCZ,IADD,oBACYY,SAAS,CAACZ,IADtB,wBAIEuB,OAAO,CAACR,QAAR,EAAoB,IAJtB,2BAKGU,KAAK,CAAC,0BAAD,CAAL,CALH,kDAMeb,SANf,EAM0BZ,IAAI,CAAJA,IAN1B,gBAQEuB,OAAO,CAACT,QAAR,EAAoB,IARtB,2BASGW,KAAK,CAAC,0BAAD,CAAL,CATH,kDAUeb,SAVf,EAU0BZ,IAAI,CAAJA,IAV1B,WAYKI,GAZL,CAYWpB,SAAS,CAAG,0CAAZ,CAAuDuC,OAAO,CAACT,QAA/D,CAAwE,YAAxE,CAAqFS,OAAO,CAACR,QAA7F,CAAsG,QAAtG,CAA+GQ,OAAO,CAACP,IAZlI,oDAasBrC,OAAO,CAAC,MAAD,CAAQyB,GAAR,CAb7B,UAaKE,QAbL,qBAcEA,QAAQ,CAACoB,UAAT,EAAqB,GAdvB,4BAeG1B,IAAI,CAACa,IAAL,CAAUU,OAAV,EAfH,kDAgBeX,SAhBf,EAgB0BZ,IAAI,CAAJA,IAhB1B,iGAoBDyB,KAAK,CAAC,aAAME,OAAP,CAAL,CApBC,kDAqBWf,SArBX,EAqBsBZ,IAAI,CAAJA,IArBtB,8BAwBDf,MAAM,CAACC,QAAP,CAAgB0C,MAAhB,GAxBC,qGAAD,CAAR,CA2BH,CA7BS,CA6BP,GA7BO,CAAV,CA8BH,CA/BD,CADa,EADX,CAkCNC,WAAW,CACP,qBAACN,OAAD,CAAUO,OAAV,QACQ,IAAIpB,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CACnBa,UAAU,CAAC,UAAM,CACbb,OAAO,GACP,GAAImB,OAAJ,CAAa,CACTC,OAAO,CAACC,GAAR,CAAYF,OAAO,CAAChB,QAApB,EACAiB,OAAO,CAACC,GAAR,CAAYT,OAAZ,EACArB,QAAQ,CAAC,kBAAMU,SAAN,4JACCZ,IADD,oBACYY,SAAS,CAACZ,IADtB,wBAIEuB,OAAO,CAACR,QAAR,EAAoB,IAJtB,2BAKGU,KAAK,CAAC,0BAAD,CAAL,CALH,kDAMeb,SANf,EAM0BZ,IAAI,CAAJA,IAN1B,gBAQEuB,OAAO,CAACT,QAAR,EAAoB,IARtB,2BASGW,KAAK,CAAC,0BAAD,CAAL,CATH,kDAUeb,SAVf,EAU0BZ,IAAI,CAAJA,IAV1B,gBAYEuB,OAAO,CAACP,IAAR,EAAgB,OAAhB,EAA2BO,OAAO,CAACP,IAAR,EAAgB,MAZ7C,4BAaGS,KAAK,CAAC,gCAAD,CAAL,CAbH,kDAceb,SAdf,EAc0BZ,IAAI,CAAJA,IAd1B,iBAgBEuB,OAAO,CAACR,QAAR,EAAoBe,OAAO,CAACf,QAhB9B,4BAiBSX,GAjBT,CAiBepB,SAAS,CAAG,4CAAZ,CAA0D8C,OAAO,CAAChB,QAAlE,CAA2E,eAA3E,CAA2FS,OAAO,CAACT,QAAnG,CAA4G,WAA5G,CAAwHS,OAAO,CAACP,IAjB/I,oDAkB0BrC,OAAO,CAAC,KAAD,CAAOyB,GAAP,CAlBjC,UAkBSE,QAlBT,qBAmBMA,QAAQ,CAACoB,UAAT,EAAqB,GAnB3B,4BAoBO1B,IAAI,CAACA,IAAI,CAACiC,OAAL,CAAaH,OAAb,CAAD,CAAJ,CAA8BP,OAA9B,CApBP,kDAqBmBX,SArBnB,EAqB8BZ,IAAI,CAAJA,IArB9B,iBAwBEuB,OAAO,CAACR,QAAR,EAAoBe,OAAO,CAACf,QAxB9B,4BAyBSX,IAzBT,CAyBepB,SAAS,CAAG,4CAAZ,CAA0D8C,OAAO,CAAChB,QAAlE,CAA2E,eAA3E,CAA2FS,OAAO,CAACT,QAAnG,CAA4G,eAA5G,CAA4HS,OAAO,CAACR,QAApI,CAA6I,WAA7I,CAAyJQ,OAAO,CAACP,IAzBhL,oDA0B0BrC,OAAO,CAAC,KAAD,CAAOyB,IAAP,CA1BjC,UA0BSE,SA1BT,qBA2BMA,SAAQ,CAACoB,UAAT,EAAqB,GA3B3B,4BA4BO1B,IAAI,CAACA,IAAI,CAACiC,OAAL,CAAaH,OAAb,CAAD,CAAJ,CAA8BP,OAA9B,CA5BP,kDA6BmBX,SA7BnB,EA6B8BZ,IAAI,CAAJA,IA7B9B,iGAkCDyB,KAAK,CAAC,aAAME,OAAP,CAAL,CAlCC,kDAmCWf,SAnCX,EAmCsBZ,IAAI,CAAJA,IAnCtB,8BAsCDf,MAAM,CAACC,QAAP,CAAgB0C,MAAhB,GAtCC,qGAAD,CAAR,CAyCH,CACJ,CA/CS,CA+CP,GA/CO,CAAV,CAgDX,CAjDO,CADR,EAnCE,CAsFNM,WAAW,CAAE,qBAAAJ,OAAO,QAChB,IAAIpB,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CACnBa,UAAU,CAAC,UAAM,CACbb,OAAO,GACPT,QAAQ,CAAC,kBAAMU,SAAN,6IACCZ,IADD,oBACYY,SAAS,CAACZ,IADtB,EAECI,GAFD,CAEOpB,SAAS,CAAG,wCAAZ,CAAqD8C,OAAO,CAAChB,QAFpE,oEAIsBnC,OAAO,CAAC,QAAD,CAAUyB,GAAV,CAJ7B,SAIKE,QAJL,qBAKEA,QAAQ,CAACoB,UAAT,EAAqB,GALvB,2BAMG1B,IAAI,CAACmC,MAAL,CAAYnC,IAAI,CAACiC,OAAL,CAAaH,OAAb,CAAZ,CAAmC,CAAnC,EANH,kDAOelB,SAPf,EAO0BZ,IAAI,CAAJA,IAP1B,gGAWDyB,KAAK,CAAC,aAAME,OAAP,CAAL,CAXC,kDAYWf,SAZX,EAYsBZ,IAAI,CAAJA,IAZtB,8BAeDf,MAAM,CAACC,QAAP,CAAgB0C,MAAhB,GAfC,qGAAD,CAAR,CAkBH,CApBS,CAoBP,GApBO,CAAV,CAqBH,CAtBD,CADgB,EAtFd,CALd,EAFJ,CAwHH","sourcesContent":["import React, {Component, useEffect} from 'react';\r\nimport '../App.css';\r\nimport {useCookies} from \"react-cookie\";\r\nimport { forwardRef } from 'react';\r\nimport MaterialTable from 'material-table';\r\nimport AddBox from '@material-ui/icons/AddBox';\r\nimport ArrowDownward from '@material-ui/icons/ArrowDownward';\r\nimport Check from '@material-ui/icons/Check';\r\nimport ChevronLeft from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRight from '@material-ui/icons/ChevronRight';\r\nimport Clear from '@material-ui/icons/Clear';\r\nimport DeleteOutline from '@material-ui/icons/DeleteOutline';\r\nimport Edit from '@material-ui/icons/Edit';\r\nimport FilterList from '@material-ui/icons/FilterList';\r\nimport FirstPage from '@material-ui/icons/FirstPage';\r\nimport LastPage from '@material-ui/icons/LastPage';\r\nimport Remove from '@material-ui/icons/Remove';\r\nimport SaveAlt from '@material-ui/icons/SaveAlt';\r\nimport Search from '@material-ui/icons/Search';\r\nimport ViewColumn from '@material-ui/icons/ViewColumn';\r\n\r\n\r\nconst tableIcons = {\r\n    Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />)\r\n};\r\n\r\n\r\nexport default function UserMgmt() {\r\n    var request = require('superagent');\r\n    const [cookies, setCookie, removeCookie] = useCookies(['user']);\r\n    const pathStart = window.location.protocol + \"//\" + window.location.host;\r\n    const [isAdm,setAdm] = React.useState(false);\r\n    const [isLoggedIn,setLoggedIn] = React.useState(false);\r\n\r\n    const [state, setState] = React.useState({\r\n        columns: [\r\n            { title: 'Username', field: 'username' },\r\n            { title: 'Password', field: 'password'},\r\n            { title: 'Privileges', field: 'priv', lookup:{admin:'admin',user:'user'} },\r\n        ],\r\n        data: [\r\n\r\n        ],\r\n    });\r\n\r\n    const getUsers = async() => {\r\n\r\n        const url = pathStart + \":8080/errorkb/api/GetAllUsers\";\r\n        const response = await fetch(url);\r\n        const userdata = await response.json();\r\n        for(let i = 0 ; i < userdata.length; i++){\r\n            new Promise(resolve => {\r\n                {resolve();\r\n                    setState(prevState => {\r\n                        const data = [...prevState.data];\r\n                        data.push({username:userdata[i].username,password:\"********\",priv:userdata[i].privileges});\r\n                        return { ...prevState, data };\r\n                    });\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n    const readCookieUser = () => {\r\n        const user = cookies.user\r\n        if (user != null) {\r\n            setLoggedIn(true);\r\n        }\r\n        else{\r\n            setLoggedIn(false);\r\n            window.location=\"/\";\r\n        }\r\n    }\r\n    const readCookieRights=()=>{\r\n        const rights = cookies.rights\r\n        if (rights == 'admin') {\r\n        }\r\n        else{\r\n            window.location=\"/\";\r\n        }\r\n    }\r\n    useEffect(()=>{\r\n        getUsers();\r\n        readCookieUser();\r\n        readCookieRights();\r\n    },[]);\r\n    return (\r\n\r\n        <MaterialTable\r\n            title=\"User Management\"\r\n            columns={state.columns}\r\n            data={state.data}\r\n            icons={tableIcons}\r\n            editable={{\r\n                onRowAdd: newData =>\r\n                    new Promise(resolve => {\r\n                        setTimeout(() => {\r\n                            resolve();\r\n                            setState(async prevState => {\r\n                                const data = [...prevState.data];\r\n\r\n                                try{\r\n                                    if(newData.password == null){\r\n                                        alert(\"Please assign a password\")\r\n                                        return { ...prevState, data };\r\n                                    }\r\n                                    if(newData.username == null){\r\n                                        alert(\"Please assign a username\")\r\n                                        return { ...prevState, data };\r\n                                    }\r\n                                    const url = pathStart + \":8080/errorkb/api/PostNewUser/?username=\"+newData.username+\"&password=\"+newData.password+\"&priv=\"+newData.priv;\r\n                                    const response = await request('POST',url);\r\n                                    if(response.statusCode==200){\r\n                                        data.push(newData);\r\n                                        return { ...prevState, data };\r\n                                    }\r\n                                }\r\n                                catch(error){\r\n                                    alert(error.message)\r\n                                    return { ...prevState, data };\r\n                                }\r\n                                finally{\r\n                                    window.location.reload();\r\n                                }\r\n                            })\r\n                        }, 600);\r\n                    }),\r\n                onRowUpdate:\r\n                    (newData, oldData) =>\r\n                            new Promise(resolve => {\r\n                                setTimeout(() => {\r\n                                    resolve();\r\n                                    if (oldData) {\r\n                                        console.log(oldData.username);\r\n                                        console.log(newData);\r\n                                        setState(async prevState => {\r\n                                            const data = [...prevState.data];\r\n\r\n                                            try{\r\n                                                if(newData.password == null){\r\n                                                    alert(\"Please assign a password\")\r\n                                                    return { ...prevState, data };\r\n                                                }\r\n                                                if(newData.username == null){\r\n                                                    alert(\"Please assign a username\")\r\n                                                    return { ...prevState, data };\r\n                                                }\r\n                                                if(newData.priv != \"admin\" && newData.priv != \"user\"){\r\n                                                    alert(\"Please assign valid privileges\")\r\n                                                    return { ...prevState, data };\r\n                                                }\r\n                                                if(newData.password == oldData.password){\r\n                                                    const url = pathStart + \":8080/errorkb/api/PutNewUser/?oldUsername=\"+ oldData.username+\"&newUsername=\"+newData.username+\"&newPriv=\"+newData.priv;\r\n                                                    const response = await request('PUT',url);\r\n                                                    if(response.statusCode==200){\r\n                                                        data[data.indexOf(oldData)] = newData;\r\n                                                        return { ...prevState, data };\r\n                                                    }\r\n                                                }\r\n                                                if(newData.password != oldData.password){\r\n                                                    const url = pathStart + \":8080/errorkb/api/PutNewUser/?oldUsername=\"+ oldData.username+\"&newUsername=\"+newData.username+\"&newPassword=\"+newData.password+\"&newPriv=\"+newData.priv;\r\n                                                    const response = await request('PUT',url);\r\n                                                    if(response.statusCode==200){\r\n                                                        data[data.indexOf(oldData)] = newData;\r\n                                                        return { ...prevState, data };\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                            catch(error){\r\n                                                alert(error.message)\r\n                                                return { ...prevState, data };\r\n                                            }\r\n                                            finally{\r\n                                                window.location.reload();\r\n                                            }\r\n                                        })\r\n                                    }\r\n                                }, 600);\r\n                    }),\r\n                onRowDelete: oldData =>\r\n                    new Promise(resolve => {\r\n                        setTimeout(() => {\r\n                            resolve();\r\n                            setState(async prevState => {\r\n                                const data = [...prevState.data];\r\n                                const url = pathStart + \":8080/errorkb/Api/DeleteUser?username=\"+oldData.username;\r\n                                try{\r\n                                    const response = await request('DELETE',url);\r\n                                    if(response.statusCode==200){\r\n                                        data.splice(data.indexOf(oldData), 1);\r\n                                        return { ...prevState, data };\r\n                                    }\r\n                                }\r\n                                catch(error){\r\n                                    alert(error.message)\r\n                                    return { ...prevState, data };\r\n                                }\r\n                                finally{\r\n                                    window.location.reload();\r\n                                }\r\n                            });\r\n                        }, 600);\r\n                    }),\r\n            }}\r\n        />\r\n    );\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}